<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Karas Ultra Edition</title>
    <link rel="icon" type="image/svg+xml" href="logo.svg">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest/dist/hls.min.js"></script>
    <style>
        :root {
            --gold: #d4a534;
            --gold-light: #f5c842;
            --dark: #020205;
            --dark-2: #05050a;
            --card: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.06);
            --radius: 20px;
            --bg-glow: #101025;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        body {
            background: var(--dark);
            color: #fff;
            font-family: 'Cairo', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            user-select: none;
            transition: background 1s ease;
        }

        /* ‚îÄ‚îÄ BACKGROUND GLOW ‚îÄ‚îÄ */
        #bgGlow {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at 0% 0%, var(--bg-glow) 0%, var(--dark) 70%);
            z-index: -1;
        }

        /* ‚îÄ‚îÄ SPLASH ‚îÄ‚îÄ */
        #splash {
            position: fixed;
            inset: 0;
            z-index: 10000;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.8s ease-out;
        }

        .splash-logo {
            width: 180px;
            filter: drop-shadow(0 0 30px var(--gold));
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.8;
            }

            50% {
                transform: scale(1.1);
                opacity: 1;
            }
        }

        /* ‚îÄ‚îÄ APP LAYOUT ‚îÄ‚îÄ */
        #app {
            display: flex;
            height: 100vh;
            opacity: 0;
            transition: opacity 1s;
        }

        /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
        aside {
            width: 80px;
            background: rgba(10, 10, 20, 0.98);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 0;
            z-index: 100;
            transition: width 0.3s;
        }

        aside:hover,
        aside:focus-within {
            width: 220px;
        }

        .nav-item {
            width: 100%;
            height: 70px;
            display: flex;
            align-items: center;
            padding: 0 25px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            color: rgba(255, 255, 255, 0.4);
            white-space: nowrap;
            gap: 20px;
        }

        .nav-item i {
            font-size: 1.6rem;
            min-width: 30px;
            text-align: center;
        }

        .nav-label {
            opacity: 0;
            transition: 0.3s;
            font-weight: 700;
            font-size: 1rem;
            transform: translateX(10px);
        }

        aside:hover .nav-label {
            opacity: 1;
            transform: translateX(0);
        }

        .nav-item:focus,
        .nav-item.active {
            color: var(--gold);
            background: rgba(212, 165, 52, 0.1);
            outline: none;
        }

        .nav-item:focus::before {
            content: '';
            position: absolute;
            right: 0;
            height: 50%;
            top: 25%;
            width: 4px;
            background: var(--gold);
            border-radius: 4px;
        }

        /* ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ */
        main {
            flex: 1;
            overflow-y: auto;
            scroll-behavior: smooth;
            padding-bottom: 200px;
        }

        /* TOP BAR */
        .top-bar {
            padding: 40px 60px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .search-container {
            position: relative;
            width: 350px;
        }

        #searchInput {
            width: 100%;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid var(--border);
            border-radius: 50px;
            padding: 12px 50px 12px 20px;
            color: #fff;
            font-family: inherit;
            font-size: 1rem;
            transition: 0.3s;
        }

        #searchInput:focus {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--gold);
            width: 450px;
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.5;
        }

        /* HERO AREA */
        .hero {
            position: relative;
            height: 60vh;
            margin: 0 40px 30px;
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            align-items: flex-end;
            padding: 40px;
            background: #000;
        }

        .hero-bg {
            position: absolute;
            inset: 0;
            background-size: cover;
            background-position: top center;
            transition: transform 0.8s, opacity 0.8s;
        }

        .hero::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, var(--dark), transparent);
        }

        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 800px;
            animation: slideUp 1s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .hero-title {
            font-size: 5.5rem;
            font-weight: 900;
            line-height: 1;
            margin: 0;
            letter-spacing: -2px;
        }

        .hero-meta {
            color: var(--gold);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }

        .badge {
            background: var(--gold);
            color: #000;
            padding: 4px 12px;
            border-radius: 6px;
            font-weight: 900;
        }

        .hero-btns {
            display: flex;
            gap: 20px;
            margin-top: 50px;
        }

        .btn {
            padding: 18px 50px;
            border-radius: 12px;
            font-weight: 900;
            font-size: 1.3rem;
            border: none;
            cursor: pointer;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn-play {
            background: #fff;
            color: #000;
        }

        .btn-play:focus,
        .btn-play:hover {
            scale: 1.1;
            background: var(--gold);
            color: #fff;
            box-shadow: 0 20px 40px rgba(212, 165, 52, 0.4);
        }

        .btn-list {
            background: rgba(255, 255, 255, 0.08);
            color: #fff;
            backdrop-filter: blur(20px);
        }

        .btn-list:focus {
            scale: 1.1;
            background: var(--gold);
            color: #000;
        }

        /* ROWS */
        .row {
            margin: 60px 0 0 60px;
            transition: 0.5s;
        }

        .row-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-left: 60px;
            margin-bottom: 25px;
        }

        .row-title {
            font-size: 2.2rem;
            font-weight: 900;
            color: #fff;
        }

        .row-title span {
            color: var(--gold);
            font-size: 1rem;
            margin-right: 15px;
            opacity: 0.6;
        }

        .row-scroller {
            display: flex;
            gap: 30px;
            overflow-x: auto;
            padding: 20px 60px 60px 0;
            scroll-behavior: smooth;
        }

        .row-scroller::-webkit-scrollbar {
            display: none;
        }

        .card {
            flex: 0 0 300px;
            aspect-ratio: 2/3;
            border-radius: var(--radius);
            overflow: hidden;
            background: #111;
            cursor: pointer;
            transition: 0.5s cubic-bezier(0.165, 0.84, 0.44, 1);
            position: relative;
            border: 2px solid transparent;
        }

        .card:focus,
        .card:hover {
            scale: 1.05;
            z-index: 10;
            border-color: var(--gold);
        }

        .card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 1) 0%, transparent 50%);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 30px;
            opacity: 0;
            transition: 0.3s;
        }

        .card:focus .card-overlay,
        .card:hover .card-overlay {
            opacity: 1;
        }

        .card-name {
            font-weight: 900;
            font-size: 1.4rem;
            line-height: 1.2;
        }

        .card-fav {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 1.8rem;
            filter: drop-shadow(0 2px 10px #000);
            transition: 0.3s;
        }

        .card-fav.active {
            color: #e50914;
            transform: scale(1.2);
        }

        /* PLAYER & MODAL */
        #modal {
            position: fixed;
            inset: 0;
            z-index: 2000;
            background: #000;
            display: none;
            flex-direction: column;
            animation: modalEnter 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        #modal.open {
            display: flex;
        }

        @keyframes modalEnter {
            from {
                opacity: 0;
                transform: scale(1.1);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .player-top {
            flex: 1;
            position: relative;
            background: #000;
        }

        #vPlayer {
            width: 100%;
            height: 100%;
            position: relative;
            z-index: 100;
        }

        #videoOverlay {
            position: absolute;
            inset: 0;
            z-index: 150;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .player-controls {
            position: absolute;
            top: 40px;
            right: 40px;
            z-index: 200;
            display: flex;
            gap: 20px;
        }

        .player-btn {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: 900;
            cursor: pointer;
            backdrop-filter: blur(20px);
        }

        .player-btn:focus {
            background: var(--gold);
            color: #000;
            scale: 1.1;
        }

        .player-bottom {
            height: 260px;
            background: #080808;
            border-top: 1px solid var(--border);
            padding: 40px 60px;
            overflow-x: auto;
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .ep-card {
            flex: 0 0 250px;
            height: 140px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.3s;
            gap: 8px;
        }

        .ep-card:focus,
        .ep-card.active {
            background: var(--gold);
            color: #000;
            border-color: var(--gold);
            scale: 1.1;
            outline: none;
        }

        .ep-num {
            font-size: 2.2rem;
            font-weight: 900;
        }

        .ep-sub {
            font-size: 0.9rem;
            font-weight: 700;
            opacity: 0.6;
        }

        /* SEARCH RESULTS */
        #searchResults {
            display: none;
            margin-bottom: 200px;
        }

        #searchResults.active {
            display: block;
        }

        .search-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            padding: 40px 60px;
        }

        /* FOOTER */
        footer {
            padding: 80px 20px;
            border-top: 1px solid var(--border);
            margin-top: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            opacity: 0.5;
            text-align: center;
        }

        footer strong {
            color: var(--gold);
        }

        .update-info {
            color: var(--gold);
            font-weight: 700;
            font-size: 0.9rem;
        }

        @media (max-width: 900px) {
            aside {
                display: none;
            }

            .hero {
                height: 50vh;
                margin: 20px;
                padding: 30px;
            }

            .hero-title {
                font-size: 3rem;
            }

            .top-bar {
                padding: 30px 20px;
            }

            .row {
                margin: 40px 20px;
            }

            .card {
                flex: 0 0 170px;
            }

            .search-container {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <div id="bgGlow"></div>

    <div id="splash">
        <img src="logo.png" class="splash-logo" alt="Karas">
        <div style="font-size: 4rem; font-weight: 900; color: var(--gold); margin-top: 20px;">KARAS</div>
        <div style="font-size: 1.2rem; opacity: 0.5; margin-top: 10px; letter-spacing: 2px;">ULTRA PREMIUM</div>
        <div
            style="margin-top: 50px; width: 300px; height: 3px; background: rgba(255,255,255,0.05); border-radius: 10px; overflow: hidden;">
            <div style="width: 30%; height: 100%; background: var(--gold); animation: load 2s infinite ease-in-out;">
            </div>
        </div>
    </div>

    <div id="app">
        <aside id="sidebar">
            <div class="nav-item active focusable" tabindex="0" onclick="location.reload()">
                <i>üè†</i> <span class="nav-label">ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</span>
            </div>
            <div class="nav-item focusable" tabindex="0" onclick="showSection('watchlist')">
                <i>‚≠ê</i> <span class="nav-label">ŸÇÿßÿ¶ŸÖÿ™Ÿä</span>
            </div>
            <div class="nav-item focusable" tabindex="0" onclick="document.getElementById('searchInput').focus()">
                <i>üîç</i> <span class="nav-label">ÿßŸÑÿ®ÿ≠ÿ´</span>
            </div>
            <div style="margin-top: auto;" class="nav-item focusable" tabindex="0">
                <i>‚öôÔ∏è</i> <span class="nav-label">ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</span>
            </div>
        </aside>

        <main id="main">
            <div class="top-bar">
                <img src="logo.png" style="height: 60px;" alt="">
                <div class="search-container">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="searchInput" placeholder="ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖÿ≥ŸÑÿ≥ŸÑŸÉ..." tabindex="0">
                </div>
            </div>

            <div id="homeContent">
                <section class="hero" id="hero">
                    <div class="hero-bg" id="heroBg"></div>
                    <div class="hero-content">
                        <div class="hero-meta"><span class="badge">ÿßŸÑÿ£ŸÉÿ´ÿ± ŸÖÿ¥ÿßŸáÿØÿ©</span> Karas Series 2026</div>
                        <h1 class="hero-title" id="heroTitle">...</h1>
                        <div class="hero-btns">
                            <button class="btn btn-play focusable" tabindex="0" id="heroPlay">‚ñ∂ ÿßŸÑŸÖÿ¥ÿßŸáÿØÿ© ÿßŸÑÿ¢ŸÜ</button>
                            <button class="btn btn-list focusable" tabindex="0" id="heroListBtn">‚ûï ŸÇÿßÿ¶ŸÖÿ™Ÿä</button>
                        </div>
                    </div>
                </section>

                <div id="rows">
                    <!-- Dynamic Rows -->
                </div>
            </div>

            <div id="searchResults" class="row">
                <div class="row-title">ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿ®ÿ≠ÿ´</div>
                <div class="search-grid" id="searchGrid"></div>
            </div>

            <footer>
                <div class="update-info" id="updateInfo">ÿ¨ÿßÿ±Ÿä ÿ¨ŸÑÿ® ÿ≠ÿßŸÑÿ© ÿßŸÑÿ≥ÿ≠ÿßÿ®...</div>
                <p>ÿ≠ŸÇŸàŸÇ ÿßŸÑŸÜÿ¥ÿ± ¬© 2026 | ÿ®Ÿàÿßÿ≥ÿ∑ÿ© <strong id="adminTrigger"
                        style="cursor:pointer; user-select:none;">Karas</strong></p>
                <div style="display: flex; gap: 20px; margin-top: 10px; font-size: 0.8rem; opacity: 0.7;">
                    <span>Android Optimized</span> ‚Ä¢ <span>Cloud Streaming</span> ‚Ä¢ <span>v2.6.0</span>
                </div>
            </footer>
        </main>
    </div>

    <div id="modal">
        <div class="player-top">
            <div class="player-controls">
                <button class="player-btn focusable" id="closeVid" tabindex="0">‚úï ÿ•ÿ∫ŸÑÿßŸÇ</button>
            </div>
            <video id="vPlayer" controls playsinline x-webkit-airplay="allow"></video>
            <div id="videoOverlay">
                <div style="text-align:center">
                    <div
                        style="width:70px; height:70px; border:5px solid var(--gold); border-top-color:transparent; border-radius:50%; animation: spin 1s linear infinite; display:inline-block">
                    </div>
                    <p style="margin-top:25px; font-weight:900; font-size: 1.5rem;" id="vStatus">ÿ¨ÿßÿ±Ÿä ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑÿ±ÿßÿ®ÿ∑
                        ÿßŸÑÿ≥ÿ≠ÿßÿ®Ÿä...</p>
                </div>
            </div>
        </div>
        <div class="player-bottom" id="epList"></div>
    </div>

    <script>
        const API = "https://ramadan-v2j0.onrender.com";
        let allData = [], watchlist = [], hls = null, currentEpIdx = 0, currentEps = [];

        // ‚îÄ‚îÄ INITIALIZATION ‚îÄ‚îÄ
        async function init() {
            watchlist = JSON.parse(localStorage.getItem('watchlist') || '[]');
            const splash = document.getElementById('splash');
            const removeSplash = () => {
                splash.style.opacity = '0';
                splash.style.pointerEvents = 'none';
                setTimeout(() => {
                    splash.style.display = 'none';
                    splash.remove();
                }, 1500);
            };

            // Failsafe: Remove splash after 5s
            setTimeout(removeSplash, 5000);

            try {
                const res = await fetch(`${API}/api/data?v=${Date.now()}`);
                const data = await res.json();
                allData = data.series || [];

                if (data.last_updated) {
                    document.getElementById('updateInfo').textContent = `ÿ¢ÿÆÿ± ÿ™ÿ≠ÿØŸäÿ´ ŸÑŸÑÿ≥ÿ≠ÿßÿ®ÿ©: ${data.last_updated}`;
                }

                if (allData.length > 0) {
                    const feat = allData[Math.floor(Math.random() * allData.length)];
                    updateHero(feat);
                }
                renderRows();

            } catch (e) {
                console.error(e);
            } finally {
                setTimeout(() => {
                    document.getElementById('app').style.opacity = '1';
                    removeSplash();
                }, 1500);
            }
        }

        function updateHero(s) {
            document.getElementById('heroBg').style.backgroundImage = `url(${s.image})`;
            document.getElementById('heroTitle').textContent = s.title;
            document.getElementById('heroPlay').onclick = () => openSeries(s.slug);

            const btn = document.getElementById('heroListBtn');
            const isFav = watchlist.includes(s.slug);
            btn.innerHTML = isFav ? "‚úÖ ŸÅŸä ŸÇÿßÿ¶ŸÖÿ™Ÿä" : "‚ûï ŸÇÿßÿ¶ŸÖÿ™Ÿä";
            btn.onclick = () => toggleWatchlist(s.slug, btn);

            updateTheme(s.image);
        }

        // ‚îÄ‚îÄ DYNAMIC THEMING (SURPRISE 2) ‚îÄ‚îÄ
        function updateTheme(imgUrl) {
            // Simulate color extraction based on poster index to give variety
            const colors = ['#101025', '#251010', '#102515', '#251510', '#181025'];
            const idx = Math.abs(imgUrl.length % colors.length);
            document.body.style.setProperty('--bg-glow', colors[idx]);
        }

        // ‚îÄ‚îÄ RENDER ROWS ‚îÄ‚îÄ
        function renderRows() {
            const container = document.getElementById('rows');
            let html = '';

            // WATCHLIST ROW (SURPRISE 1)
            if (watchlist.length > 0) {
                const favData = allData.filter(s => watchlist.includes(s.slug));
                html += `
                    <div class="row">
                        <div class="row-header"><div class="row-title">ŸÇÿßÿ¶ŸÖÿ™Ÿä <span>ŸÑŸÑŸàÿµŸàŸÑ ÿßŸÑÿ≥ÿ±Ÿäÿπ</span></div></div>
                        <div class="row-scroller">${favData.map(s => renderCard(s)).join('')}</div>
                    </div>
                `;
            }

            const sections = [
                { title: "ÿ£ÿ≠ÿØÿ´ ÿßŸÑÿ≠ŸÑŸÇÿßÿ™", data: allData.slice(0, 10) },
                { title: "ŸÖÿ≥ŸÑÿ≥ŸÑÿßÿ™ ÿ±ŸÖÿ∂ÿßŸÜ ÿßŸÑŸÖŸÖŸäÿ≤ÿ©", data: allData.slice(10, 25) },
                { title: "ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅ ÿßŸÑŸÉÿßŸÖŸÑ", data: allData.slice(25) }
            ];

            html += sections.map(sec => `
                <div class="row">
                    <div class="row-header"><div class="row-title">${sec.title}</div></div>
                    <div class="row-scroller">${sec.data.map(s => renderCard(s)).join('')}</div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        function renderCard(s) {
            const isFav = watchlist.includes(s.slug);
            return `
                <button class="card series-trigger focusable" data-slug="${s.slug}" tabindex="0">
                    <img src="${s.image}" onerror="this.src='logo.png'">
                    <div class="card-fav ${isFav ? 'active' : ''}">‚òÖ</div>
                    <div class="card-overlay">
                        <div class="card-name">${s.title}</div>
                    </div>
                </button>
            `;
        }

        // Global Event Delegation for Cards (More reliable on Mobile/TV)
        document.addEventListener('click', (e) => {
            const card = e.target.closest('.series-trigger');
            if (card) {
                e.preventDefault();
                const slug = card.getAttribute('data-slug');
                if (slug) openSeries(slug);
            }
        });

        // Keyboard Support (Enter/Space)
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                const card = document.activeElement.closest('.series-trigger');
                if (card) {
                    e.preventDefault();
                    const slug = card.getAttribute('data-slug');
                    if (slug) openSeries(slug);
                }
            }
        });

        // ‚îÄ‚îÄ WATCHLIST LOGIC ‚îÄ‚îÄ
        function toggleWatchlist(slug, btn) {
            const idx = watchlist.indexOf(slug);
            if (idx > -1) watchlist.splice(idx, 1);
            else watchlist.push(slug);
            localStorage.setItem('watchlist', JSON.stringify(watchlist));
            if (btn) btn.innerHTML = watchlist.includes(slug) ? "‚úÖ ŸÅŸä ŸÇÿßÿ¶ŸÖÿ™Ÿä" : "‚ûï ŸÇÿßÿ¶ŸÖÿ™Ÿä";
            renderRows();
        }

        // ‚îÄ‚îÄ SEARCH LOGIC ‚îÄ‚îÄ
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', (e) => {
            const q = e.target.value.toLowerCase();
            if (q.length > 0) {
                const results = allData.filter(s => s.title.toLowerCase().includes(q));
                document.getElementById('homeContent').style.display = 'none';
                document.getElementById('searchResults').classList.add('active');
                document.getElementById('searchGrid').innerHTML = results.length > 0
                    ? results.map(s => renderCard(s)).join('')
                    : '<div style="width:100%; text-align:center; padding:100px; opacity:0.5"><h3>ÿπÿ∞ÿ±ÿßŸãÿå ŸÑŸÖ ŸÜÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨ ŸÑÿ®ÿ≠ÿ´ŸÉ</h3></div>';
            } else {
                hideSearch();
            }
        });

        function hideSearch() {
            document.getElementById('homeContent').style.display = 'block';
            document.getElementById('searchResults').classList.remove('active');
            searchInput.value = '';
        }

        // ‚îÄ‚îÄ PLAYER & EPISODES ‚îÄ‚îÄ
        async function openSeries(slug) {
            const series = allData.find(s => s.slug === slug);
            updateTheme(series.image);
            document.getElementById('modal').classList.add('open');
            document.getElementById('epList').innerHTML = '<div style="width:100%; text-align:center">ÿ¨ÿßÿ±Ÿä ÿ¨ŸÑÿ® ÿßŸÑÿ≠ŸÑŸÇÿßÿ™...</div>';

            try {
                const res = await fetch(`${API}/api/episodes?slug=${slug}`);
                const data = await res.json();
                currentEps = data.episodes || [];

                document.getElementById('epList').innerHTML = currentEps.map((ep, i) => `
                    <div class="ep-card focusable" id="ep-${i}" tabindex="0" onclick="playEpisode(${i})">
                        <div class="ep-num">${i + 1}</div>
                        <div class="ep-sub">ÿßŸÑÿ≠ŸÑŸÇÿ©</div>
                    </div>
                `).join('');

                if (currentEps.length > 0) playEpisode(0);
            } catch (e) {
                document.getElementById('epList').innerHTML = '‚ö†Ô∏è ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ≠ŸÑŸÇÿßÿ™';
            }
        }

        async function playEpisode(idx) {
            currentEpIdx = idx;
            const ep = currentEps[idx];
            const v = document.getElementById('vPlayer');
            const overlay = document.getElementById('videoOverlay');

            // Highlight active episode
            document.querySelectorAll('.ep-card').forEach(c => c.classList.remove('active'));
            document.getElementById(`ep-${idx}`)?.classList.add('active');
            document.getElementById(`ep-${idx}`)?.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });

            if (hls) hls.destroy();
            v.pause(); v.src = "";
            overlay.style.display = 'flex';

            try {
                const res = await fetch(`${API}/api/stream?url=${encodeURIComponent(ep.url)}`);
                const data = await res.json();
                if (data.url) {
                    if (data.url.includes('.m3u8')) {
                        if (Hls.isSupported()) {
                            hls = new Hls();
                            hls.loadSource(data.url);
                            hls.attachMedia(v);
                            hls.on(Hls.Events.MANIFEST_PARSED, () => {
                                v.play();
                                overlay.style.display = 'none';
                            });
                        } else {
                            v.src = data.url; v.play();
                            overlay.style.display = 'none';
                        }
                    } else {
                        v.src = data.url; v.play();
                        overlay.style.display = 'none';
                    }
                }
            } catch (e) { alert("‚ö†Ô∏è ÿ™ÿπÿ∞ÿ± ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ≠ŸÑŸÇÿ©"); }
        }

        // ‚îÄ‚îÄ AUTO-NEXT (SURPRISE 3) ‚îÄ‚îÄ
        document.getElementById('vPlayer').addEventListener('ended', () => {
            if (currentEpIdx < currentEps.length - 1) {
                console.log("üé¨ Play next episode automatically...");
                playEpisode(currentEpIdx + 1);
            }
        });

        document.getElementById('closeVid').onclick = () => {
            document.getElementById('modal').classList.remove('open');
            document.getElementById('vPlayer').pause();
            if (hls) hls.destroy();
        };

        // FOCUS MANAGEMENT
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') document.getElementById('closeVid').click();
        });

        let adminClicks = 0;
        let adminTimer;
        document.getElementById('adminTrigger').addEventListener('click', () => {
            adminClicks++;
            if (adminClicks >= 4) {
                location.href = "https://ramadan-v2j0.onrender.com/admin";
            }
            clearTimeout(adminTimer);
            adminTimer = setTimeout(() => { adminClicks = 0; }, 1500);
        });

        init();
    </script>
</body>

</html>